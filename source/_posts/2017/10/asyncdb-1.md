title: Asyncdb（一）：写一个纯函数式的Mysql异步驱动
author: Godpan
tags: 
- Asyncdb
- 数据库
- 网络编程
description: 之前的Akka系列博客接下去可能并不会经常更新了，但是后续看到一些好的点或者大家对哪些还是比较感兴趣还会继续写几篇，这里先跟大家说明一下。
date: 2017-10-09 12:00
---

之前的 [Akka系列博客](https://scala.cool/tags/Akka/) 接下去可能并不会经常更新了，但是后续看到一些好的点或者大家对哪些还是比较感兴趣还会继续写几篇，这里先跟大家说明一下。

### 背景

**写一个纯函数式的Mysql异步驱动**这个构思是公司的一个大佬提的，这将会是一个开源项目，我也很有幸能够参与其中，尝试写一个自己真正意义上的开源项目，其实很多人会有疑惑，为什么我们要做一个数据库驱动，就目前JVM生态上，已经有了比较成熟的产品，我们还能做出一个怎样的数据库驱动呢？

首先我们明确了一点，绝不做重复造轮子的事，做这个项目一定要有意义，即使未来可能实用性兼容性等方面不是很擅长，我们也要表达出新的设计理念，能给数据库驱动注入一股新的活力。

我们在确定这个项目的时候，也对目前JVM生态中的数据库驱动进行了一定的总结，仅供参考：

项目|mysql-async|HikariCP + mysql-connector/j
---|---|---
编程模型 | 异步 | 同步
网络IO | NIO | BIO
链接池 | 异步实现 | 同步实现
过载防护 | 通过调节队列长度实现 | 需要额外实现 （例如指定线程池任务队列长度）
可伸缩性 | 只需要设置合理连接数(例如几十个) | 需要测试最佳线程数和链接数
线程数 | 少 | 多

具体相关测试及说明可以看我们写的相关系列文章[MySQL 异步驱动浅析 （一）：性能分析](https://scala.cool/2017/04/mysql-async-1/)。

相信写过Java工程的同学都应该知道mysql-connector-java，但应该很多人对其的实现和相关架构设计应该不是很了解，正如我们上面对其相关功能测试，发现它的某些方面表现并不是很好，比如使用了BIO，请求时需要大量的线程等等。

相信你们也注意到了mysql-async，但是应该大多数人都不是很熟悉，它也是一个基于Netty，使用Scala编写的，完全异步的数据库驱动，同时支持PostgreSQL和MySQL，其项目地址[postgresql-async](https://github.com/mauricio/postgresql-async)。

其实我们公司项目底层用的数据库驱动也是基于mysql-async的，不过因为实际使用中遇到了一些问题，，具体相关问题分析可以看我们写的相关系列文章[MySQL 异步驱动浅析 （二）：缺点分析](https://scala.cool/2017/05/mysql-async-2/)。

虽然我们使用的mysql-async内部版本对上述的许多问题都进行了修复，具体信息可以看我们写的相关系列文章[MySQL 异步驱动浅析 （三）：连接池改进方案](https://scala.cool/2017/07/mysql-async-3/)，但是整个项目变得混乱，架构设计也不是很完美，所以我们最终决定自己实现一个纯函数式的Mysql异步驱动，我们叫它：**asyncdb**

### 目标

那么我们到底要做一个怎样的驱动呢？我们提了以下几个主要方面：

- 1.构建于cats-effect(纯函数式的关键)
- 2.合理的数据库包解析框架
- 3.支持简单的流处理(可选)
- 4.基于Java NIO2，绝不阻塞
- 5.提供对应Java8的接口

总的来说，除了第一点大家可能比较陌生，其他几点大家都应该能大致了解,但是第一点才是我们这个项目最重要的一点，也是用来解决我们之前遇到问题的关键，后续我会写几篇文章对于这一点进行的相关介绍，如果有兴趣的同学可以自己了解一下：[cats-effect](https://github.com/typelevel/cats-effect)

### 关注 Asyncdb

如果你对我们的项目也有兴趣，欢迎你们star我们的项目，项目地址:[asyncdb](https://github.com/asyncdb/asyncdb),我们将会从头开始，你可以一步一步了解我们的架构设计和具体的实现方法，当然你有好的想法或者相关问题，也欢迎给我们提issue。

### 进阶学习

若是你对数据库驱动非常有兴趣，也想探究里面的奥秘，这里我提一些相应的建议：

- 1.熟悉了解Java NIO，并熟练使用它
- 2.学习MySQL数据库网络传输包协议
- 3.掌握函数式语言中的Monad表达式，理解其的含义和使用场景
- 4.学习Scala相关的函数库比如：[cats](https://github.com/typelevel/cats),[shapeless](https://github.com/milessabin/shapeless)
- 5.学习IO-Monad(cats-effect)

最后也希望大家能参与其中，帮助我们不断的完善它，共同成长！



